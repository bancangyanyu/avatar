"use strict";const e=require("../../common/vendor.js");if(!Array){e.resolveComponent("fui-tabs")()}Math;const a={},o=Object.assign(a,{__name:"avatar",setup(a){const o=e.ref([{name:"国庆"},{name:"中秋节"},{name:"圣诞"},{name:"新年"},{name:"王者"},{name:"和平精英"},{name:"情人节"},{name:"端午节"},{name:"元宵节"},{name:"其他"}]),t=e.ref(!1),l=e.ref(200),n=e.ref(0),s=e.ref(1);e.ref("发现一张好看的头像，快来看看吧！");const i=e.ref([]),r=e.ref(""),c=e.ref(""),u=e.ref(""),d=e.ref(-1),v=e.ref(!1);e.ref(getApp().globalData.IS_ANDROID),e.ref(e.wx$1.getSystemInfoSync().windowWidth/2),e.ref(300),e.ref(e.wx$1.getSystemInfoSync().windowWidth/2+50-2),e.ref(300),e.ref(100),e.ref(1),e.ref(0),e.ref(0),e.computed((()=>5===s.value?["text-white"]:""));const h=e.computed((()=>5===s.value?["bg-white"]:""));e.computed((()=>r.value)),e.computed((()=>ImgPath[s.value]));const m=({index:e})=>{f(e+1)},f=async(a=1)=>{e.index.showLoading({title:"加载中..."});try{const{result:{data:o}}=await e.er.callFunction({name:"page-url-query",data:{type:a}}),[t]=o;t.photo_url=t&&t.photo_url?null==t?void 0:t.photo_url.split("*"):[],i.value=(null==t?void 0:t.photo_url)||"",c.value=c.value||t.avatar_url,r.value=t.page_url}catch(o){console.error(o)}finally{e.index.hideLoading()}},g=e=>{console.log("选择的头像",e),c.value=e.detail.avatarUrl},w=e=>{const{maskId:a}=e.target.dataset;d.value=a,u.value=i.value[a],v.value=!0},x=async()=>{if(-1===d.value){const a=await p(c.value);return I({tempFilePath:a}),void e.index.showToast({title:"您还没选择挂件哦",duration:2e3,icon:"none"})}y()},p=a=>(e.index.showLoading({title:"加载中"}),new Promise(((o,t)=>{e.index.getImageInfo({src:a,success:a=>{console.log("获取的图片信息",a.path),e.index.hideLoading(),o(a.path)}})}))),y=async()=>{const a=e.wx$1.createSelectorQuery();a.select("#avatar-bg").boundingClientRect(),a.exec((async a=>{const o=e.wx$1.createCanvasContext("cans-id-mask");e.wx$1.getSystemInfoSync().windowWidth;const t=await p(u.value),n=await p(c.value);o.clearRect(0,0,l.value,l.value),o.drawImage(n,0,0,l.value,l.value),o.drawImage(t,0,0,l.value,l.value),await o.draw(!1,(()=>{b()}))}))},I=a=>{const{tempFilePath:o}=a;e.index.hideLoading(),e.index.saveImageToPhotosAlbum({filePath:o,success:a=>{e.index.showModal({title:"保存成功",content:"头像已经在您的相册里啦",showCancel:!1}),e.index.vibrateShort({success:()=>{console.log("vibrateShort")}})},fail:a=>{console.log("error",a),a.errMsg.indexOf("fail")&&e.index.showModal({title:"您需要授权相册权限",success:a=>{a.confirm&&e.index.openSetting({success(e){console.log("相册授权成功")},fail(e){console.log(e)}})}})}})},_=()=>{e.index.canvasToTempFilePath({x:0,y:0,height:l.value,width:l.value,destWidth:3*l.value,destHeight:3*l.value,canvasId:"cans-id-mask",success:e=>{console.log("canvas",e.tempFilePath),I(e)},fail:a=>{e.index.hideLoading()}},this)},b=()=>{e.index.showLoading({title:"保存...",mask:!0}),_()};e.onLoad((a=>{(async()=>{const a=await e.er.callFunction({name:"show-share"});t.value=a.result.data[0].show,t.value||e.wx$1.hideShareMenu({success:function(){console.log("成功隐藏分享按钮")},fail:function(){console.log("隐藏分享按钮失败")}}),console.log("show",a)})(),(e=>{console.log("ddddddd",e);const a=(null==e?void 0:e.item)?JSON.parse(null==e?void 0:e.item):{},{img_url:o}=a;c.value=o,f()})(a);let o=null;e.wx$1.createInterstitialAd&&(o=e.wx$1.createInterstitialAd({adUnitId:"adunit-c1116f19272e97a2"}),o.onLoad((()=>{})),o.onError((e=>{console.error("插屏广告加载失败",e)})),o.onClose((()=>{}))),o&&o.show().catch((e=>{console.error("插屏广告显示失败",e)}))}));return(a,l)=>e.e({a:c.value,b:e.o((a=>{return o=c.value,void e.index.previewImage({current:0,urls:[o]});var o})),c:d.value>-1},d.value>-1?{d:v.value?1:"",e:u.value}:{},{f:e.o(g),g:e.n(h.value),h:e.o(x),i:e.n(h.value),j:t.value},t.value?{k:e.n(h.value)}:{},{l:e.o(m),m:e.o((e=>n.value=e)),n:e.p({scroll:!0,tabs:o.value,selectClass:"text-yellow",modelValue:n.value}),o:e.f(i.value,((a,o,t)=>({a:a,b:o,c:e.o(w,o),d:o}))),p:`url(${c.value}) no-repeat left/100%`})}}),t=e._export_sfc(o,[["__scopeId","data-v-e1fb31b8"]]);o.__runtimeHooks=2,wx.createPage(t);
