(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"0095":function(t,e,a){"use strict";(function(t){a("fbbb");n(a("66fd"));var e=n(a("9ca7"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])},"306a":function(t,e,a){"use strict";var n=a("c360"),s=a.n(n);s.a},"82c9":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=a("c450"),s={1:"china",2:"chris",3:"holiday",4:"new"},i={data:function(){return{AvatarUrl:n.AvatarUrl,PageUrl:n.PageUrl,duration:15,windowHeight:0,cansWidth:270,cansHeight:270,imgList:(0,n.range)(0,6,1),currentMaskId:-1,showBorder:!1,maskCenterX:wx.getSystemInfoSync().windowWidth/2,maskCenterY:250,cancelCenterX:wx.getSystemInfoSync().windowWidth/2-50-2,cancelCenterY:200,handleCenterX:wx.getSystemInfoSync().windowWidth/2+50-2,handleCenterY:300,maskSize:100,scale:1,rotate:0,rotateY:0,mask_center_x:wx.getSystemInfoSync().windowWidth/2,mask_center_y:250,cancel_center_x:wx.getSystemInfoSync().windowWidth/2-50-2,cancel_center_y:200,handle_center_x:wx.getSystemInfoSync().windowWidth/2+50-2,handle_center_y:300,scaleCurrent:1,rotateCurrent:0,touch_target:"",start_x:0,start_y:0,avatarType:1,avatarPath:"",imageInfo:"把袜子翻过来，里朝外，挂起来，整个世界都是你的礼物"}},computed:{maskPic:function(){var t=this.avatarType,e=this.currentMaskId,a=s[t];return"/static/image/".concat(a,"/").concat(e,".png")},pageImage:function(){var t=this.avatarType,e=void 0===t?1:t,a=this.PageUrl;return console.log("背景",a[e]),a[e]},imgPath:function(){var t=this.avatarType;return s[t]},avatarPathImage:{get:function(){var t=this.avatarType,e=void 0===t?1:t,a=this.AvatarUrl;return console.log("背景",a[e]),this.avatarPath=a[e],a[e]},set:function(t){this.avatarPath=t}}},onLoad:function(t){wx.showShareMenu({menus:["shareAppMessage","shareTimeline"],success:function(t){console.log(t)},fail:function(t){console.log(t)}}),this.handleOption(t),console.log(t)},onShareAppMessage:function(){var t=this.imageInfo,e=this.avatarPathImage;return{title:t,imageUrl:e,path:"/pages/index/index",success:function(t){console.log(t)}}},methods:{handleOption:function(t){var e=(null===t||void 0===t?void 0:t.item)?JSON.parse(null===t||void 0===t?void 0:t.item):{},a=e.avatarType,n=void 0===a?2:a;e.info;this.avatarType=n,this.windowHeight=getApp().globalData.windowHeight},touchAvatarBg:function(){this.showBorder=!1},touchStart:function(t){console.log("e.target.id",t.target.id),"mask"==t.target.id?(this.touch_target="mask",this.showBorder=!0):"handle"==t.target.id?this.touch_target="handle":this.touch_target="",""!=this.touch_target&&(this.start_x=t.touches[0].clientX,this.start_y=t.touches[0].clientY)},touchMove:function(t){var e=t.touches[0].clientX,a=t.touches[0].clientY,n=e-this.start_x,s=a-this.start_y;if("mask"==this.touch_target&&(this.maskCenterX=this.maskCenterX+n,this.maskCenterY=this.maskCenterY+s,this.cancelCenterX=this.cancelCenterX+n,this.cancelCenterY=this.cancelCenterY+s,this.handleCenterX=this.handleCenterX+n,this.handleCenterY=this.handleCenterY+s),"handle"==this.touch_target){this.handleCenterX=this.handleCenterX+n,this.handleCenterY=this.handleCenterY+s,this.cancelCenterX=2*this.maskCenterX-this.handleCenterX,this.cancelCenterY=2*this.maskCenterY-this.handleCenterY;var i=this.handle_center_x-this.mask_center_x,r=this.handle_center_y-this.mask_center_y,c=this.handleCenterX-this.mask_center_x,o=this.handleCenterY-this.mask_center_y,h=Math.sqrt(i*i+r*r),l=Math.sqrt(c*c+o*o),d=Math.atan2(r,i)/Math.PI*180,u=Math.atan2(o,c)/Math.PI*180;this.scale=l/h*this.scaleCurrent,this.rotate=u-d+this.rotateCurrent}this.start_x=e,this.start_y=a},touchEnd:function(t){this.mask_center_x=this.maskCenterX,this.mask_center_y=this.maskCenterY,this.cancel_center_x=this.cancelCenterX,this.cancel_center_y=this.cancelCenterY,this.handle_center_x=this.handleCenterX,this.handle_center_y=this.handleCenterY,this.touch_target="",this.scaleCurrent=this.scale,this.rotateCurrent=this.rotate},getUserInfo:function(e){var a=this;if(t.showLoading({title:"获取头像中"}),"getUserInfo:ok"===e.detail.errMsg){var n=e.detail.userInfo;n.avatarUrl=n.avatarUrl.replace("132","0"),console.log("头像",n.avatarUrl),t.downloadFile({url:n.avatarUrl,success:function(e){t.hideLoading(),a.avatarPath=e.tempFilePath},fail:function(t){console.log(t),a.handleImageModal()}})}else t.showModal({title:"获取用户头像失败",content:"用户信息仅用于创建新的图片，请放心使用",showCancel:!1})},handleImageModal:function(){var e=this;t.hideLoading(),t.showModal({title:"图片加载超时",content:"网络异常，请稍后重试",success:function(t){t.confirm?e.downloadAvatarAndPaintAll():t.cancel&&console.log("用户点击取消")}})},changeMask:function(t){this.currentMaskId=t.target.dataset.maskId,this.showBorder=!0},draw:function(){-1!=this.currentMaskId?this.handleDrawImage():t.showToast({title:"您还没选择挂件哦",duration:2e3,icon:"none"})},handleDrawImage:function(){var t=this,e=this.maskPic,a=this.avatarPath,n=this.scale,s=this.rotate,i=this.isAndroid,r=this.cansWidth,c=this.cansHeight,o=this.mask_center_x,h=this.mask_center_y,l=wx.createSelectorQuery();l.select("#avatar-bg").boundingClientRect(),l.exec((function(l){o-=l[0].left,h-=l[0].top;var d=wx.createCanvasContext("cans-id-mask"),u=(wx.getSystemInfoSync().windowWidth,100*n);d.clearRect(0,0,r,c),d.drawImage(a,0,0,r,c),d.translate(o,h),d.rotate(s*Math.PI/180),i&&180==t.rotateY&&d.scale(-1,1),d.drawImage(e,-u/2,-u/2,u,u),d.draw(),t.saveCans()}))},handleSaveSuccess:function(e){var a=this,n=e.tempFilePath;t.hideLoading(),t.saveImageToPhotosAlbum({filePath:n,success:function(e){t.showModal({title:"保存成功",content:"头像已经在您的相册里啦",showCancel:!1}),t.vibrateShort({success:function(){console.log("vibrateShort")}})},fail:function(t){t.errMsg.indexOf("fail")&&a.hadleSaveErrorModal()}})},hadleSaveErrorModal:function(){t.showModal({title:"您需要授权相册权限",success:function(e){e.confirm&&t.openSetting({success:function(t){console.log("相册授权成功")},fail:function(t){console.log(t)}})}})},handleSaveImage:function(){var e=this;t.canvasToTempFilePath({x:0,y:0,height:this.cansWidth,width:this.cansHeight,destWidth:3*this.cansWidth,destHeight:3*this.cansHeight,canvasId:"cans-id-mask",success:function(t){e.handleSaveSuccess(t)},fail:function(e){t.hideLoading()}},this)},saveCans:function(){t.showLoading({title:"保存...",mask:!0}),this.handleSaveImage()}}};e.default=i}).call(this,a("543d")["default"])},"834c":function(t,e,a){"use strict";a.r(e);var n=a("82c9"),s=a.n(n);for(var i in n)"default"!==i&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=s.a},"9ca7":function(t,e,a){"use strict";a.r(e);var n=a("f728"),s=a("834c");for(var i in s)"default"!==i&&function(t){a.d(e,t,(function(){return s[t]}))}(i);a("306a");var r,c=a("f0c5"),o=Object(c["a"])(s["default"],n["b"],n["c"],!1,null,"121a2374",null,!1,n["a"],r);e["default"]=o.exports},c360:function(t,e,a){},f728:function(t,e,a){"use strict";var n;a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return n}));var s=function(){var t=this,e=t.$createElement;t._self._c},i=[]}},[["0095","common/runtime","common/vendor"]]]);