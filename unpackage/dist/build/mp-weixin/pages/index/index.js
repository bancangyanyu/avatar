(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index"],{"116f":function(t,e,a){},"2c56":function(t,e,a){"use strict";(function(t,e){var n=a("47a9");a("94bc"),a("861b");n(a("3240"));var r=n(a("76ce"));t.__webpack_require_UNI_MP_PLUGIN__=a,e(r.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},"376b":function(t,e,a){"use strict";(function(t,n,r){var i=a("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=i(a("7eb4")),o=i(a("34cf")),c=i(a("ee10")),h=a("acdb"),l={1:"china",2:"chris",3:"holiday",4:"new",5:"love"},u={components:{uniFab:function(){a.e("components/uni-fab/uni-fab").then(function(){return resolve(a("da9b"))}.bind(null,a)).catch(a.oe)}},data:function(){return{fabList:h.fabList,AvatarUrl:h.AvatarUrl,PageUrl:h.PageUrl,duration:15,windowHeight:0,cansWidth:270,cansHeight:270,currentMaskId:-1,showBorder:!1,maskCenterX:t.getSystemInfoSync().windowWidth/2,maskCenterY:250,cancelCenterX:t.getSystemInfoSync().windowWidth/2-50-2,cancelCenterY:200,handleCenterX:t.getSystemInfoSync().windowWidth/2+50-2,handleCenterY:300,maskSize:100,scale:1,rotate:0,rotateY:0,mask_center_x:t.getSystemInfoSync().windowWidth/2,mask_center_y:250,cancel_center_x:t.getSystemInfoSync().windowWidth/2-50-2,cancel_center_y:200,handle_center_x:t.getSystemInfoSync().windowWidth/2+50-2,handle_center_y:300,scaleCurrent:1,rotateCurrent:0,touch_target:"",start_x:0,start_y:0,avatarType:1,avatarPath:"",imageInfo:"把袜子翻过来，里朝外，挂起来，整个世界都是你的礼物",imgList:[],pageUrl:"",avatarUrl:"",maskPic:"",isAndroid:getApp().globalData.IS_ANDROID}},computed:{pageImage:function(){var t=this.pageUrl;return t},imgPath:function(){var t=this.avatarType;return l[t]},imgInfoColor:function(){var t=this.avatarType,e=5===t?["text-white"]:"";return e},btnColor:function(){var t=this.avatarType,e=5===t?["bg-white"]:"";return e}},onLoad:function(e){t.showShareMenu({menus:["shareAppMessage","shareTimeline"],success:function(t){console.log(t)},fail:function(t){console.log(t)}}),this.handleOption(e),console.log(e)},onShareAppMessage:function(){this.imageInfo;var t=this.avatarUrl;return{title:"把袜子翻过来，里朝外，挂起来，整个世界都是你的礼物",imageUrl:t,path:"/pages/index/index",success:function(t){console.log(t)}}},methods:{handleTrigger:function(t){var e=t.index;switch(e){case 0:n.navigateBack({delta:1});break;default:n.navigateBack({delta:1});break}console.log(t)},handelGetPageUrl:function(t){var e=this;return(0,c.default)(s.default.mark((function a(){var i,c,h,l,u;return s.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n.showLoading({title:"加载中..."}),a.next=3,r.callFunction({name:"page-url-query",data:{type:t}}).catch((function(t){n.hideLoading(),n.showModal({content:"查询失败，错误信息为：".concat(t.message),showCancel:!1}),console.error(t)}));case 3:i=a.sent,c=i.result.data,h=(0,o.default)(c,1),l=h[0],u=l.photo_url,l.photo_url=u.split("*"),e.imgList=l.photo_url,e.avatarUrl=l.avatar_url,e.pageUrl=l.page_url,console.log("查询的数据",l),n.hideLoading();case 13:case"end":return a.stop()}}),a)})))()},handleOption:function(t){var e=null!==t&&void 0!==t&&t.item?JSON.parse(null===t||void 0===t?void 0:t.item):{},a=e.avatarType,n=void 0===a?1:a,r=e.info;this.avatarType=n,this.imageInfo=r,this.handelGetPageUrl(n),this.windowHeight=getApp().globalData.windowHeight},touchAvatarBg:function(){this.showBorder=!1},touchStart:function(t){console.log("e.target.id",t.target.id),"mask"==t.target.id?(this.touch_target="mask",this.showBorder=!0):"handle"==t.target.id?this.touch_target="handle":this.touch_target="",""!=this.touch_target&&(this.start_x=t.touches[0].clientX,this.start_y=t.touches[0].clientY)},touchMove:function(t){var e=t.touches[0].clientX,a=t.touches[0].clientY,n=e-this.start_x,r=a-this.start_y;if("mask"==this.touch_target&&(this.maskCenterX=this.maskCenterX+n,this.maskCenterY=this.maskCenterY+r,this.cancelCenterX=this.cancelCenterX+n,this.cancelCenterY=this.cancelCenterY+r,this.handleCenterX=this.handleCenterX+n,this.handleCenterY=this.handleCenterY+r),"handle"==this.touch_target){this.handleCenterX=this.handleCenterX+n,this.handleCenterY=this.handleCenterY+r,this.cancelCenterX=2*this.maskCenterX-this.handleCenterX,this.cancelCenterY=2*this.maskCenterY-this.handleCenterY;var i=this.handle_center_x-this.mask_center_x,s=this.handle_center_y-this.mask_center_y,o=this.handleCenterX-this.mask_center_x,c=this.handleCenterY-this.mask_center_y,h=Math.sqrt(i*i+s*s),l=Math.sqrt(o*o+c*c),u=Math.atan2(s,i)/Math.PI*180,d=Math.atan2(c,o)/Math.PI*180;this.scale=l/h*this.scaleCurrent,this.rotate=d-u+this.rotateCurrent}this.start_x=e,this.start_y=a},touchEnd:function(t){this.mask_center_x=this.maskCenterX,this.mask_center_y=this.maskCenterY,this.cancel_center_x=this.cancelCenterX,this.cancel_center_y=this.cancelCenterY,this.handle_center_x=this.handleCenterX,this.handle_center_y=this.handleCenterY,this.touch_target="",this.scaleCurrent=this.scale,this.rotateCurrent=this.rotate},getUserInfo:function(t){var e=this;if("getUserInfo:ok"===t.detail.errMsg){var a=t.detail.userInfo;a.avatarUrl=a.avatarUrl.replace("132","0"),console.log("头像",a.avatarUrl),n.showLoading({title:"加载中..."}),n.downloadFile({url:a.avatarUrl,success:function(t){n.hideLoading(),e.avatarUrl=t.tempFilePath},fail:function(t){console.log(t),e.handleImageModal()}})}else n.showModal({title:"获取用户头像失败",content:"用户信息仅用于创建新的图片，请放心使用",showCancel:!1})},handleImageModal:function(){var t=this;n.hideLoading(),n.showModal({title:"图片加载超时",content:"网络异常，请稍后重试",success:function(e){e.confirm?t.downloadAvatarAndPaintAll():e.cancel&&console.log("用户点击取消")}})},changeMask:function(t){var e=this;return(0,c.default)(s.default.mark((function a(){var n,r;return s.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=t.target.dataset.maskId,e.currentMaskId=n,r=e.imgList[n],e.maskPic=r,e.showBorder=!0;case 5:case"end":return a.stop()}}),a)})))()},draw:function(){-1!=this.currentMaskId?this.handleDrawImage():n.showToast({title:"您还没选择挂件哦",duration:2e3,icon:"none"})},getImageInfo:function(t){return n.showLoading({title:"加载中"}),new Promise((function(e,a){n.getImageInfo({src:t,success:function(t){console.log("获取的图片信息",t.path),n.hideLoading(),e(t.path)}})}))},handleDrawImage:function(){var e=this;return(0,c.default)(s.default.mark((function a(){var n,r,i,o,h,l,u,d;return s.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=e.scale,r=e.rotate,i=e.isAndroid,o=e.cansWidth,h=e.cansHeight,e.currentMaskId,l=e.mask_center_x,u=e.mask_center_y,d=t.createSelectorQuery(),d.select("#avatar-bg").boundingClientRect(),d.exec(function(){var a=(0,c.default)(s.default.mark((function a(c){var d,f,g,m;return s.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return l-=c[0].left,u-=c[0].top,d=t.createCanvasContext("cans-id-mask"),t.getSystemInfoSync().windowWidth,f=100*n,a.next=7,e.getImageInfo(e.maskPic);case 7:return g=a.sent,a.next=10,e.getImageInfo(e.avatarUrl);case 10:return m=a.sent,d.clearRect(0,0,o,h),d.drawImage(m,0,0,o,h),d.translate(l,u),d.rotate(r*Math.PI/180),i&&180==e.rotateY&&d.scale(-1,1),d.drawImage(g,-f/2,-f/2,f,f),a.next=19,d.draw(!1,(function(){e.saveCans()}));case 19:case"end":return a.stop()}}),a)})));return function(t){return a.apply(this,arguments)}}());case 5:case"end":return a.stop()}}),a)})))()},handleSaveSuccess:function(t){var e=this,a=t.tempFilePath;n.hideLoading(),n.saveImageToPhotosAlbum({filePath:a,success:function(t){n.showModal({title:"保存成功",content:"头像已经在您的相册里啦",showCancel:!1}),n.vibrateShort({success:function(){console.log("vibrateShort")}})},fail:function(t){t.errMsg.indexOf("fail")&&e.hadleSaveErrorModal()}})},hadleSaveErrorModal:function(){n.showModal({title:"您需要授权相册权限",success:function(t){t.confirm&&n.openSetting({success:function(t){console.log("相册授权成功")},fail:function(t){console.log(t)}})}})},handleSaveImage:function(){var t=this;n.canvasToTempFilePath({x:0,y:0,height:this.cansWidth,width:this.cansHeight,destWidth:3*this.cansWidth,destHeight:3*this.cansHeight,canvasId:"cans-id-mask",success:function(e){console.log("canvas",e.tempFilePath),t.handleSaveSuccess(e)},fail:function(t){n.hideLoading()}},this)},saveCans:function(){n.showLoading({title:"保存...",mask:!0}),this.handleSaveImage()}}};e.default=u}).call(this,a("3223")["default"],a("df3c")["default"],a("861b")["uniCloud"])},4777:function(t,e,a){"use strict";var n=a("116f"),r=a.n(n);r.a},"76ce":function(t,e,a){"use strict";a.r(e);var n=a("a02a"),r=a("f6e2");for(var i in r)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return r[t]}))}(i);a("4777");var s=a("828b"),o=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,"189d1fe4",null,!1,n["a"],void 0);e["default"]=o.exports},a02a:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){}));var n=function(){var t=this.$createElement;this._self._c},r=[]},f6e2:function(t,e,a){"use strict";a.r(e);var n=a("376b"),r=a.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(i);e["default"]=r.a}},[["2c56","common/runtime","common/vendor"]]]);