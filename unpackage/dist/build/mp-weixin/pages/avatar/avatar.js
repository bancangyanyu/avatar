(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/avatar/avatar"],{"02b1":function(t,e,a){},"0a4e":function(t,e,a){"use strict";var n=a("02b1"),i=a.n(n);i.a},"1ad9":function(t,e,a){"use strict";(function(t,e){var n=a("47a9");a("94bc"),a("861b");n(a("3240"));var i=n(a("fc99"));t.__webpack_require_UNI_MP_PLUGIN__=a,e(i.default)}).call(this,a("3223")["default"],a("df3c")["createPage"])},"279e":function(t,e,a){"use strict";a.r(e);var n=a("75aa"),i=a.n(n);for(var r in n)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(r);e["default"]=i.a},"75aa":function(t,e,a){"use strict";(function(t,n,i){var r=a("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s=r(a("7eb4")),c=r(a("34cf")),o=r(a("ee10")),h=a("2de6"),l={1:"china",2:"chris",3:"holiday",4:"new",5:"love"},u={components:{uniFab:function(){a.e("components/uni-fab/uni-fab").then(function(){return resolve(a("da9b"))}.bind(null,a)).catch(a.oe)}},data:function(){return{tabList:[{name:"国庆",icon:""},{name:"NBA",icon:""},{name:"圣诞",icon:""}],tabActive:0,fabList:h.fabList,AvatarUrl:h.AvatarUrl,PageUrl:h.PageUrl,duration:15,windowHeight:0,cansWidth:220,cansHeight:220,currentMaskId:-1,showBorder:!1,maskCenterX:t.getSystemInfoSync().windowWidth/2,maskCenterY:250,cancelCenterX:t.getSystemInfoSync().windowWidth/2-50-2,cancelCenterY:200,handleCenterX:t.getSystemInfoSync().windowWidth/2+50-2,handleCenterY:300,maskSize:100,scale:1,rotate:0,rotateY:0,mask_center_x:t.getSystemInfoSync().windowWidth/2,mask_center_y:250,cancel_center_x:t.getSystemInfoSync().windowWidth/2-50-2,cancel_center_y:200,handle_center_x:t.getSystemInfoSync().windowWidth/2+50-2,handle_center_y:300,scaleCurrent:1,rotateCurrent:0,touch_target:"",start_x:0,start_y:0,avatarType:1,avatarPath:"",imageInfo:"圣诞快乐呀！",imgList:[],pageUrl:"",avatarUrl:"",maskPic:"",isAndroid:getApp().globalData.IS_ANDROID}},computed:{pageImage:function(){var t=this.pageUrl;return t},imgPath:function(){var t=this.avatarType;return l[t]},imgInfoColor:function(){var t=this.avatarType,e=5===t?["text-white"]:"";return e},btnColor:function(){var t=this.avatarType,e=5===t?["bg-white"]:"";return e}},onLoad:function(e){t.showShareMenu({menus:["shareAppMessage","shareTimeline"],success:function(t){console.log(t)},fail:function(t){console.log(t)}}),this.handleOption(e),console.log(e)},onShareTimeline:function(){var t=this.imageInfo,e=this.avatarUrl;return{title:t,imageUrl:e}},onShareAppMessage:function(){var t=this.imageInfo,e=this.avatarUrl;return{title:t,imageUrl:e,path:"/pages/avatar/avatar",success:function(t){console.log(t)}}},methods:{onTabSelect:function(t){this.tabActive=t,this.handelGetPageUrl(t+1)},handleTrigger:function(t){var e=t.index;switch(e){case 0:n.navigateBack({delta:1});break;case 1:n.switchTab({url:"/pages/images/images"});break;default:n.navigateBack({delta:1});break}console.log(t)},handelGetPageUrl:function(){var t=arguments,e=this;return(0,o.default)(s.default.mark((function a(){var r,o,h,l,u,d,f;return s.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=t.length>0&&void 0!==t[0]?t[0]:1,n.showLoading({title:"加载中..."}),a.next=4,i.callFunction({name:"page-url-query",data:{type:r}}).catch((function(t){n.hideLoading(),n.showModal({content:"查询失败，错误信息为：".concat(t.message),showCancel:!1}),console.error(t)}));case 4:o=a.sent,h=o.result.data,l=(0,c.default)(h,1),u=l[0],d=u.photo_url,u.photo_url=d.split("*"),e.imgList=u.photo_url,e.avatarUrl=e.avatarUrl||u.avatar_url,e.pageUrl=u.page_url,f=["🇨🇳 盛世华章，头像换装庆华诞！","🏀 换上主队球衣打造你的热血NBA！","🎄 圣诞帽+小鹿角，点亮你的节日！"],e.imageInfo=f[r-1],console.log("查询的数据",u),n.hideLoading();case 16:case"end":return a.stop()}}),a)})))()},handleOption:function(t){var e=null!==t&&void 0!==t&&t.item?JSON.parse(null===t||void 0===t?void 0:t.item):{},a=e.avatarType,n=void 0===a?1:a,i=e.info;this.avatarType=n,this.imageInfo=i,this.handelGetPageUrl(n),this.windowHeight=getApp().globalData.windowHeight},touchAvatarBg:function(){this.showBorder=!1},touchStart:function(t){console.log("e.target.id",t.target.id),"mask"==t.target.id?(this.touch_target="mask",this.showBorder=!0):"handle"==t.target.id?this.touch_target="handle":this.touch_target="",""!=this.touch_target&&(this.start_x=t.touches[0].clientX,this.start_y=t.touches[0].clientY)},touchMove:function(t){var e=t.touches[0].clientX,a=t.touches[0].clientY,n=e-this.start_x,i=a-this.start_y;if("mask"==this.touch_target&&(this.maskCenterX=this.maskCenterX+n,this.maskCenterY=this.maskCenterY+i,this.cancelCenterX=this.cancelCenterX+n,this.cancelCenterY=this.cancelCenterY+i,this.handleCenterX=this.handleCenterX+n,this.handleCenterY=this.handleCenterY+i),"handle"==this.touch_target){this.handleCenterX=this.handleCenterX+n,this.handleCenterY=this.handleCenterY+i,this.cancelCenterX=2*this.maskCenterX-this.handleCenterX,this.cancelCenterY=2*this.maskCenterY-this.handleCenterY;var r=this.handle_center_x-this.mask_center_x,s=this.handle_center_y-this.mask_center_y,c=this.handleCenterX-this.mask_center_x,o=this.handleCenterY-this.mask_center_y,h=Math.sqrt(r*r+s*s),l=Math.sqrt(c*c+o*o),u=Math.atan2(s,r)/Math.PI*180,d=Math.atan2(o,c)/Math.PI*180;this.scale=l/h*this.scaleCurrent,this.rotate=d-u+this.rotateCurrent}this.start_x=e,this.start_y=a},touchEnd:function(t){this.mask_center_x=this.maskCenterX,this.mask_center_y=this.maskCenterY,this.cancel_center_x=this.cancelCenterX,this.cancel_center_y=this.cancelCenterY,this.handle_center_x=this.handleCenterX,this.handle_center_y=this.handleCenterY,this.touch_target="",this.scaleCurrent=this.scale,this.rotateCurrent=this.rotate},onChooseavatar:function(t){this.avatarUrl=t.detail.avatarUrl},handleImageModal:function(){var t=this;n.hideLoading(),n.showModal({title:"图片加载超时",content:"网络异常，请稍后重试",success:function(e){e.confirm?t.downloadAvatarAndPaintAll():e.cancel&&console.log("用户点击取消")}})},changeMask:function(t){var e=this;return(0,o.default)(s.default.mark((function a(){var n,i;return s.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=t.target.dataset.maskId,e.currentMaskId=n,i=e.imgList[n],e.maskPic=i,e.showBorder=!0;case 5:case"end":return a.stop()}}),a)})))()},draw:function(){-1!=this.currentMaskId?this.handleDrawImage():n.showToast({title:"您还没选择挂件哦",duration:2e3,icon:"none"})},getImageInfo:function(t){return n.showLoading({title:"加载中"}),new Promise((function(e,a){n.getImageInfo({src:t,success:function(t){console.log("获取的图片信息",t.path),n.hideLoading(),e(t.path)}})}))},handleDrawImage:function(){var e=this;return(0,o.default)(s.default.mark((function a(){var n,i,r,c,h,l,u,d;return s.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:n=e.scale,i=e.rotate,r=e.isAndroid,c=e.cansWidth,h=e.cansHeight,e.currentMaskId,l=e.mask_center_x,u=e.mask_center_y,d=t.createSelectorQuery(),d.select("#avatar-bg").boundingClientRect(),d.exec(function(){var a=(0,o.default)(s.default.mark((function a(o){var d,f,g,m;return s.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return l-=o[0].left,u-=o[0].top,d=t.createCanvasContext("cans-id-mask"),t.getSystemInfoSync().windowWidth,f=100*n,a.next=7,e.getImageInfo(e.maskPic);case 7:return g=a.sent,a.next=10,e.getImageInfo(e.avatarUrl);case 10:return m=a.sent,d.clearRect(0,0,c,h),d.drawImage(m,0,0,c,h),d.translate(l,u),d.rotate(i*Math.PI/180),r&&180==e.rotateY&&d.scale(-1,1),d.drawImage(g,-f/2,-f/2,f,f),a.next=19,d.draw(!1,(function(){e.saveCans()}));case 19:case"end":return a.stop()}}),a)})));return function(t){return a.apply(this,arguments)}}());case 5:case"end":return a.stop()}}),a)})))()},handleSaveSuccess:function(t){var e=this,a=t.tempFilePath;n.hideLoading(),n.saveImageToPhotosAlbum({filePath:a,success:function(t){n.showModal({title:"保存成功",content:"头像已经在您的相册里啦",showCancel:!1}),n.vibrateShort({success:function(){console.log("vibrateShort")}})},fail:function(t){t.errMsg.indexOf("fail")&&e.hadleSaveErrorModal()}})},hadleSaveErrorModal:function(){n.showModal({title:"您需要授权相册权限",success:function(t){t.confirm&&n.openSetting({success:function(t){console.log("相册授权成功")},fail:function(t){console.log(t)}})}})},handleSaveImage:function(){var t=this;n.canvasToTempFilePath({x:0,y:0,height:this.cansWidth,width:this.cansHeight,destWidth:3*this.cansWidth,destHeight:3*this.cansHeight,canvasId:"cans-id-mask",success:function(e){console.log("canvas",e.tempFilePath),t.handleSaveSuccess(e)},fail:function(t){n.hideLoading()}},this)},saveCans:function(){n.showLoading({title:"保存...",mask:!0}),this.handleSaveImage()}}};e.default=u}).call(this,a("3223")["default"],a("df3c")["default"],a("861b")["uniCloud"])},9640:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return n}));var n={uniTab:function(){return a.e("components/uni-tab/uni-tab").then(a.bind(null,"8397"))}},i=function(){var t=this.$createElement;this._self._c},r=[]},fc99:function(t,e,a){"use strict";a.r(e);var n=a("9640"),i=a("279e");for(var r in i)["default"].indexOf(r)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(r);a("0a4e");var s=a("828b"),c=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"fe61eeec",null,!1,n["a"],void 0);e["default"]=c.exports}},[["1ad9","common/runtime","common/vendor"]]]);